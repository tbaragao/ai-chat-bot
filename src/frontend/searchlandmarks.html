<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Demo</title>
    <!-- Tailwind (Play CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { margin: 0; font-family: system-ui, sans-serif; }
      a { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      function truncate200(s) {
        if (!s) return "";
        return s.length > 200 ? s.slice(0, 200) + "â€¦" : s;
      }

      function App() {
        const [q, setQ] = useState("");
        const [isLoading, setLoading] = useState(false);
        const [error, setError] = useState(null);
        const [results, setResults] = useState([]);

        async function onSearch(e) {
          e?.preventDefault();
          if (!q.trim()) return;
          setLoading(true);
          setError(null);
          setResults([]);
          try {
            const res = await fetch(`http://localhost:5108/search?query=${encodeURIComponent(q.trim())}`, {
              method: "GET",
              headers: { "Content-Type": "application/json" }
            });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            if (!Array.isArray(data)) throw new Error("Expected an array of results");
            setResults(data);
          } catch (err) {
            console.error(err);
            setError(err.message || String(err));
          } finally {
            setLoading(false);
          }
        }

        return (
          <div className="min-h-screen bg-neutral-100">
            <header className="sticky top-0 bg-white border-b">
              <div className="mx-auto max-w-4xl px-6 py-4 flex items-center justify-between">
                <h1 className="text-xl font-semibold">ðŸ”Ž Search Demo</h1>
              </div>
            </header>

            <main className="mx-auto max-w-4xl px-6 py-8">
              {/* Search bar */}
              <form onSubmit={onSearch} className="flex items-stretch gap-2">
                <input
                  type="text"
                  placeholder="Search the webâ€¦"
                  className="flex-1 rounded-xl border border-neutral-300 px-4 py-3 text-[16px] focus:outline-none focus:border-neutral-400 bg-white"
                  value={q}
                  onChange={(e) => setQ(e.target.value)}
                />
                <button
                  type="submit"
                  disabled={isLoading || !q.trim()}
                  className="px-5 py-3 rounded-xl bg-blue-600 text-white disabled:bg-gray-300"
                >
                  {isLoading ? "Searchingâ€¦" : "Search"}
                </button>
              </form>

              {/* Status */}
              {error && (
                <div className="mt-4 text-sm text-rose-700 bg-rose-50 border border-rose-200 rounded-xl p-3">
                  Error: {error}
                </div>
              )}

              {/* Results */}
              <section className="mt-8">
                {results.length === 0 && !isLoading ? (
                  <p className="text-neutral-500">No results yet. Try a search.</p>
                ) : (
                  <ul className="space-y-5">
                    {results.map((r, i) => (
                      <li key={i} className="bg-white border border-neutral-200 rounded-2xl p-4">
                        <a href={r.pageUrl} target="_blank" rel="noreferrer" className="text-blue-700 font-semibold">
                          {r.title || r.pageUrl}
                        </a>
                        <p className="mt-1 text-[15px] text-neutral-800">{truncate200(r.content)}</p>
                        <p className="mt-1 text-xs text-neutral-500 break-all">{r.pageUrl}</p>
                      </li>)
                    )}
                  </ul>
                )}
              </section>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
